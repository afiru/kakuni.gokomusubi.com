(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,o=window.wp.element,a=window.wp.i18n,n=window.wp.blockEditor,i=window.wp.components;function l(e){var{isUserAuthorized:t,locations:n,categories:l,services:s,providers:r,attributes:p,setAttributes:c,closeModal:d,saveParameters:m}=e;return(0,o.createElement)(i.Modal,{className:"sb-widget-modal",title:(0,a.__)("Edit predefined parameters","simplybook"),onRequestClose:d},(0,o.createElement)(i.PanelBody,null,t?(0,o.createElement)(o.Fragment,null,(0,o.createElement)("div",{className:"wp-sb-popup-info"},(0,o.createElement)("p",{className:"wp-sb--p"},(0,a.__)("This feature allows you to customize your booking widget specifically for a service, provider, category, or location.","simplybook")),(0,o.createElement)("p",{className:"wp-sb--p"},(0,a.__)("For example, if you have two services, A and B, and choose service A as predefined, the widget will open directly on that service, skipping the step of choosing a service. This is useful if you want to display only certain services on a specific page of your website. Note that if you select a provider not connected to the chosen service, the widget will not work. These settings will immediately apply to the widget, ensuring a streamlined booking process.","simplybook"))),(0,o.createElement)("div",{className:"wp-sb-popup-predefine-form"},n.length>0&&(0,o.createElement)(i.SelectControl,{label:(0,a.__)("Predefined location","simplybook"),value:p.location,options:[{label:(0,a.__)("Select location","simplybook"),value:0},...n.map((e=>({label:e.name,value:e.id})))],onChange:e=>c({location:parseInt(e)})}),l.length>0&&(0,o.createElement)(i.SelectControl,{label:(0,a.__)("Predefined category","simplybook"),value:p.category,options:[{label:(0,a.__)("Select category","simplybook"),value:0},...l.map((e=>({label:e.name,value:e.id})))],onChange:e=>c({category:parseInt(e)})}),s.length>0&&(0,o.createElement)(i.SelectControl,{label:(0,a.__)("Predefined service","simplybook"),value:p.service,options:[{label:(0,a.__)("Select service","simplybook"),value:0},...s.map((e=>({label:e.name,value:e.id})))],onChange:e=>c({service:parseInt(e)})}),r.length>0&&(0,o.createElement)(i.SelectControl,{label:(0,a.__)("Predefined provider","simplybook"),value:p.provider,options:[{label:(0,a.__)("Select provider","simplybook"),value:"0"},...r.map((e=>({label:e.name,value:String(e.id)})))],onChange:e=>{c({provider:String(e)})}})),(0,o.createElement)("div",{className:"wp-sb-popup-predefine-btnBar"},(0,o.createElement)(i.Button,{onClick:m,className:"sb-widget-save-btn",isPrimary:!0},(0,a.__)("Save","simplybook")))):(0,o.createElement)("p",{className:"sb-widget-alert"},(0,a.__)("You are not authorized in ","simplybook"),(0,o.createElement)("a",{href:"/wp-admin/admin.php?page=simplybook-integration"},(0,a.__)("SimplyBook.me plugin","simplybook")))))}const s=window.React;var r=e.n(s);const p=window.wp.apiFetch;var c=e.n(p);const d=simplybook.nonce,m=(simplybook.x_wp_nonce,simplybook.rest_namespace+"/"+simplybook.rest_version+"/"),u=(simplybook.rest_url,simplybook.rest_namespace,simplybook.rest_version,b("rest_url"));function b(e){let t=simplybook[e];return"https:"!==window.location.protocol||t.includes("https://")||(t=t.replace("http://","https://")),t}b("ajax_url"),simplybook.simplybook_domains;const w=async(e,t="POST",o={})=>{const a={path:e,method:t,data:o};a.path=m+a.path+(u.includes("?")?"&":"?")+"&token="+Math.random().toString(36).substring(2,7),a.data={...o,nonce:d},"GET"===t&&console.log("the request method is not adjusted for GET requests yet. ");try{return await(async(e,t="POST",o={})=>{const a={path:e,method:t,data:o};return await c()(a)})(a.path,a.method,a.data)}catch(e){((e,t)=>{console.error(`API Error at ${t}:`,e.message||e)})(e,a.path)}},y=JSON.parse('{"UU":"simplybook/widget","uK":{"location":{"type":"number","default":0},"category":{"type":"number","default":0},"service":{"type":"number","default":0},"provider":{"type":"string","default":"0"}}}');(0,t.registerBlockType)(y.UU,{apiVersion:2,edit:function(e){const{attributes:t,setAttributes:s}=e,p=(0,n.useBlockProps)(),[c,d]=(0,o.useState)(!1),[m,u]=(0,o.useState)(!1),[b,y]=(0,o.useState)(!1),[g,v]=(0,o.useState)([]),[h,_]=(0,o.useState)([]),[f,k]=(0,o.useState)([]),[E,S]=(0,o.useState)([]),[P,N]=(0,o.useState)(null),[C,T]=(0,o.useState)(null),[B,M]=(0,o.useState)(null),[O,D]=(0,o.useState)(null),[x,z]=(0,o.useState)(""),A=r().createRef();(0,o.useEffect)((()=>{const e=async e=>await w(e,"POST");e("internal/is-authorized").then(y),Promise.all([e("internal/locations"),e("internal/categories"),e("internal/services"),e("internal/providers")]).then((([e,t,o,a])=>{v(e),_(t),k(o),S(a)}))}),[]);const L=()=>d(!1);(0,o.useEffect)((()=>{if(g.length>0){const e=g.find((e=>e.id===t.location));N(e?e.name:null)}if(h.length>0){const e=h.find((e=>e.id===t.category));T(e?e.name:null)}if(f.length>0){const e=f.find((e=>e.id===t.service));M(e?e.name:null)}if(console.log(E),console.log(t.provider),E.length>0){const e=E.find((e=>String(e.id)===String(t.provider)));D(e?e.name:null)}}),[g,h,f,E,t]);return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(n.BlockControls,null,(0,o.createElement)(i.ToolbarGroup,null,(0,o.createElement)(i.ToolbarButton,{onClick:()=>(()=>{let e=new FormData;e.append("action","sb_preview_widget"),t.location&&e.append("formData[predefined][location]",t.location),t.category&&e.append("formData[predefined][category]",t.category),t.service&&e.append("formData[predefined][service]",t.service),t.provider&&e.append("formData[predefined][provider]",t.provider),e.append("_wpnonce",window.simplybook.nonce),e=new URLSearchParams(e).toString();let o=new XMLHttpRequest;o.open("POST","/wp-admin/admin-ajax.php",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){console.log(o.responseText);var e=JSON.parse(o.responseText);e&&e.html&&(z(e.html),u(!0),setTimeout((()=>{var e=document.getElementById("simplybook-preview-modal").getElementsByTagName("script");if(0!==e.length){var t=e[0].innerHTML.replace("DOMContentLoaded","sbDOMContentLoaded");window.eval(t);var o=new Event("sbDOMContentLoaded");document.dispatchEvent(o)}else console.warn("No script found in widget preview")}),300))}},o.send(e)})(),icon:"visibility"},(0,a.__)("Preview","simplybook")))),(0,o.createElement)("div",p,(0,o.createElement)(i.PanelBody,null,(0,o.createElement)("div",{className:"sb-widget-container"},(0,o.createElement)(i.Dashicon,{icon:"simplybook",size:25,className:"sb-widget-icon"}),(0,o.createElement)("h3",{className:"wp-sb-title wp-sb-title_h3 sb-widget-title"},(0,a.__)("SimplyBook.me Widget","simplybook")),(0,o.createElement)("p",{className:"wp-sb-txt wp-sb--p wp-sb--p_secondary --subtitle"},(0,a.__)("Easily customize and streamline your booking process with predefined options for services, providers, categories and locations.","simplybook")),b?(0,o.createElement)(o.Fragment,null,P?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-location"},(0,a.__)("Location: ","simplybook")+P):null,C?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-category"},(0,a.__)("Category: ","simplybook")+C):null,B?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-service"},(0,a.__)("Service: ","simplybook")+B):null,O?(0,o.createElement)("p",{className:"wp-sb--p sb-widget-predefined sb-widget-provider"},(0,a.__)("Provider: ","simplybook")+O):null,(0,o.createElement)(i.Button,{onClick:()=>d(!0),className:"sb-widget-edit-btn",isPrimary:!0},(0,a.__)("Edit predefined parameters","simplybook")),(0,o.createElement)("div",{style:{clear:"both"}})):(0,o.createElement)("p",{className:"sb-widget-alert"},(0,a.__)("You are not authorized in ","simplybook"),(0,o.createElement)("a",{href:"/wp-admin/admin.php?page=simplybook-integration"},(0,a.__)("SimplyBook.me plugin","simplybook"))))),c&&(0,o.createElement)(l,{isUserAuthorized:b,locations:g,categories:h,services:f,providers:E,attributes:t,setAttributes:s,saveParameters:()=>{s(t),L()},closeModal:L}),m&&(0,o.createElement)(i.Modal,{className:"sb-widget-modal sb-widget-preview-modal",title:(0,a.__)("WidgetPreview","simplybook"),onRequestClose:()=>u(!1),ref:A},(0,o.createElement)(i.PanelBody,null,(0,o.createElement)("div",{dangerouslySetInnerHTML:{__html:x},id:"simplybook-preview-modal"})))))},save:function(){return(0,o.createElement)("div",n.useBlockProps.save(),(0,o.createElement)(n.InnerBlocks.Content,null))},attributes:y.uK})})();